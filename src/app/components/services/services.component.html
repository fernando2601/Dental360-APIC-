<div class="px-4 py-6 sm:px-0">
  <!-- Header -->
  <div class="sm:flex sm:items-center mb-6">
    <div class="sm:flex-auto">
      <h3 class="text-lg leading-6 font-medium text-gray-900">Serviços</h3>
      <p class="mt-2 text-sm text-gray-700">Gerenciar serviços oferecidos pela clínica</p>
    </div>
    <div class="mt-4 sm:mt-0 sm:ml-16 sm:flex-none">
      <button (click)="openAddServiceModal()" class="btn btn-primary">
        Novo Serviço
      </button>
    </div>
  </div>

  <!-- Filters -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
    <div>
      <label class="block text-sm font-medium text-gray-700">Buscar</label>
      <input 
        [(ngModel)]="searchTerm" 
        (input)="filterServices()"
        type="text" 
        placeholder="Nome do serviço ou categoria"
        class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-primary-500 focus:border-primary-500">
    </div>
    <div>
      <label class="block text-sm font-medium text-gray-700">Categoria</label>
      <select 
        [(ngModel)]="categoryFilter" 
        (change)="filterServices()"
        class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-primary-500 focus:border-primary-500">
        <option value="">Todas as categorias</option>
        <option *ngFor="let category of getUniqueCategories()" [value]="category">{{ category }}</option>
      </select>
    </div>
  </div>

  <!-- Services Grid -->
  <div *ngIf="loading" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    <div *ngFor="let i of [1,2,3,4,5,6]" class="card p-6 animate-pulse">
      <div class="h-4 bg-gray-200 rounded w-3/4 mb-2"></div>
      <div class="h-3 bg-gray-200 rounded w-1/2 mb-4"></div>
      <div class="h-8 bg-gray-200 rounded w-1/3"></div>
    </div>
  </div>

  <div *ngIf="!loading" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    <div *ngFor="let service of filteredServices" class="card p-6 hover:shadow-lg transition-shadow">
      <div class="flex justify-between items-start mb-4">
        <div class="flex-1">
          <h4 class="text-lg font-medium text-gray-900">{{ service.name }}</h4>
          <p class="text-sm text-gray-500 mt-1">{{ service.category }}</p>
        </div>
        <div class="relative">
          <button class="text-gray-400 hover:text-gray-600" (click)="toggleServiceMenu(service.id)">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
              <path d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"></path>
            </svg>
          </button>
          <div *ngIf="activeMenuId === service.id" class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg z-10 border">
            <div class="py-1">
              <button (click)="editService(service)" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 w-full text-left">
                Editar
              </button>
              <button (click)="duplicateService(service)" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 w-full text-left">
                Duplicar
              </button>
              <button (click)="deleteService(service)" class="block px-4 py-2 text-sm text-red-600 hover:bg-gray-100 w-full text-left">
                Excluir
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <p class="text-sm text-gray-600 mb-4">{{ service.description }}</p>
      
      <div class="flex justify-between items-center">
        <div>
          <div class="text-2xl font-bold text-primary-600">{{ formatCurrency(service.price) }}</div>
          <div class="text-sm text-gray-500">{{ service.duration_minutes }} minutos</div>
        </div>
        <div class="flex items-center space-x-2">
          <span *ngIf="service.is_active" class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">
            Ativo
          </span>
          <span *ngIf="!service.is_active" class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800">
            Inativo
          </span>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="!loading && filteredServices.length === 0" class="text-center py-12">
    <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
    </svg>
    <h3 class="mt-2 text-sm font-medium text-gray-900">Nenhum serviço encontrado</h3>
    <p class="mt-1 text-sm text-gray-500">Comece adicionando um novo serviço.</p>
    <div class="mt-6">
      <button (click)="openAddServiceModal()" class="btn btn-primary">
        Adicionar Serviço
      </button>
    </div>
  </div>
</div>

<!-- Service Modal -->
<div *ngIf="showModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
  <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
    <div class="mt-3">
      <!-- Modal Header -->
      <div class="flex items-center justify-between pb-3 border-b">
        <h3 class="text-lg font-medium text-gray-900">
          {{ isEditing ? 'Editar Serviço' : 'Novo Serviço' }}
        </h3>
        <button (click)="closeModal()" class="text-gray-400 hover:text-gray-600">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>

      <!-- Modal Body -->
      <div class="mt-4">
        <form [formGroup]="serviceForm" (ngSubmit)="saveService()">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- Nome -->
            <div class="md:col-span-2">
              <label class="block text-sm font-medium text-gray-700">Nome do Serviço *</label>
              <input 
                type="text" 
                formControlName="name"
                class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-primary-500 focus:border-primary-500">
            </div>

            <!-- Categoria -->
            <div>
              <label class="block text-sm font-medium text-gray-700">Categoria *</label>
              <select 
                formControlName="category"
                class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-primary-500 focus:border-primary-500">
                <option value="">Selecione uma categoria</option>
                <option value="Preventivo">Preventivo</option>
                <option value="Restaurador">Restaurador</option>
                <option value="Cirúrgico">Cirúrgico</option>
                <option value="Endodontia">Endodontia</option>
                <option value="Ortodontia">Ortodontia</option>
                <option value="Implantologia">Implantologia</option>
                <option value="Prótese">Prótese</option>
                <option value="Estético">Estético</option>
                <option value="Periodontia">Periodontia</option>
              </select>
            </div>

            <!-- Preço -->
            <div>
              <label class="block text-sm font-medium text-gray-700">Preço (R$) *</label>
              <input 
                type="number" 
                formControlName="price"
                step="0.01"
                min="0"
                class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-primary-500 focus:border-primary-500">
            </div>

            <!-- Duração -->
            <div>
              <label class="block text-sm font-medium text-gray-700">Duração (minutos) *</label>
              <input 
                type="number" 
                formControlName="duration_minutes"
                min="15"
                step="15"
                class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-primary-500 focus:border-primary-500">
            </div>

            <!-- Status -->
            <div>
              <label class="block text-sm font-medium text-gray-700">Status</label>
              <select 
                formControlName="is_active"
                class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-primary-500 focus:border-primary-500">
                <option [value]="true">Ativo</option>
                <option [value]="false">Inativo</option>
              </select>
            </div>

            <!-- Descrição -->
            <div class="md:col-span-2">
              <label class="block text-sm font-medium text-gray-700">Descrição</label>
              <textarea 
                formControlName="description"
                rows="3"
                class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-primary-500 focus:border-primary-500"></textarea>
            </div>
          </div>

          <!-- Modal Footer -->
          <div class="flex justify-end space-x-3 mt-6 pt-4 border-t">
            <button type="button" (click)="closeModal()" class="btn btn-secondary">
              Cancelar
            </button>
            <button type="submit" [disabled]="!serviceForm.valid || saving" class="btn btn-primary">
              <span *ngIf="saving" class="inline-block animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"></span>
              {{ isEditing ? 'Atualizar' : 'Salvar' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>